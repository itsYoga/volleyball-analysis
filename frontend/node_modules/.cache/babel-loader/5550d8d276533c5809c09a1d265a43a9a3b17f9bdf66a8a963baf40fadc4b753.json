{"ast":null,"code":"var _jsxFileName = \"/Users/jesse/Documents/\\u5C08\\u984C/volleyball_analysis_webapp/frontend/src/components/VideoPlayer.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { getVideoUrl, getAnalysisResults, getVideo } from '../services/api';\nimport { EventTimeline } from './EventTimeline';\nimport { PlayerHeatmap } from './PlayerHeatmap';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const VideoPlayer = ({\n  videoId\n}) => {\n  _s();\n  const params = useParams();\n  const effectiveId = videoId && videoId.length > 0 ? videoId : params.videoId;\n  const [result, setResult] = useState(null);\n  const [status, setStatus] = useState('idle');\n  const [error, setError] = useState('');\n  const [currentTime, setCurrentTime] = useState(0);\n  const videoRef = useRef(null);\n  useEffect(() => {\n    if (!effectiveId) return;\n    let isMounted = true;\n    const load = async () => {\n      setStatus('loading');\n      setError('');\n      try {\n        const meta = await getVideo(effectiveId);\n        if (!isMounted) return;\n        if (meta.status !== 'completed') {\n          setStatus(meta.status);\n          setResult(null);\n          return;\n        }\n        const res = await getAnalysisResults(effectiveId);\n        if (!isMounted) return;\n        setResult(res);\n        setStatus('completed');\n      } catch (e) {\n        setError((e === null || e === void 0 ? void 0 : e.message) || 'Failed to load analysis results');\n        setStatus('error');\n      }\n    };\n    load();\n    return () => {\n      isMounted = false;\n    };\n  }, [effectiveId]);\n  const handleSeek = sec => {\n    if (videoRef.current) videoRef.current.currentTime = sec;\n  };\n  useEffect(() => {\n    const el = videoRef.current;\n    if (!el) return;\n    const onTime = () => setCurrentTime(el.currentTime || 0);\n    el.addEventListener('timeupdate', onTime);\n    return () => el.removeEventListener('timeupdate', onTime);\n  }, []);\n  if (status === 'loading') return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"max-w-3xl mx-auto bg-white rounded shadow p-6\",\n    children: \"Loading...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 55,\n    columnNumber: 36\n  }, this);\n  if (status === 'processing') return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"max-w-3xl mx-auto bg-yellow-50 border border-yellow-200 text-yellow-800 rounded p-6\",\n    children: \"Analysis in progress. Please check back later from Library.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 56,\n    columnNumber: 39\n  }, this);\n  if (status === 'failed') return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"max-w-3xl mx-auto bg-red-50 border border-red-200 text-red-800 rounded p-6\",\n    children: \"Analysis failed. Please re-run analysis from Library.\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 57,\n    columnNumber: 35\n  }, this);\n  if (status === 'error') return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"max-w-3xl mx-auto bg-red-50 border border-red-200 text-red-800 rounded p-6\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"font-semibold mb-2\",\n      children: \"Failed to load results\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-sm\",\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: () => {\n        setStatus('idle');\n        setError('');\n        setResult(null);\n      },\n      className: \"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\",\n      children: \"Retry\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 62,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 59,\n    columnNumber: 5\n  }, this);\n  if (!result) return null;\n  const {\n    action_recognition,\n    scores,\n    players_tracking,\n    game_states,\n    video_info\n  } = result;\n  const fps = (video_info === null || video_info === void 0 ? void 0 : video_info.fps) || 30;\n  const totalFrames = (video_info === null || video_info === void 0 ? void 0 : video_info.total_frames) || Math.round(((video_info === null || video_info === void 0 ? void 0 : video_info.duration) || 0) * fps) || 1000;\n  const currentFrame = Math.max(0, Math.min(totalFrames, Math.round(currentTime * fps)));\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"relative w-full max-w-3xl mx-auto\",\n    children: [/*#__PURE__*/_jsxDEV(\"video\", {\n      ref: videoRef,\n      src: getVideoUrl(effectiveId),\n      controls: true,\n      width: (video_info === null || video_info === void 0 ? void 0 : video_info.width) || 640,\n      height: (video_info === null || video_info === void 0 ? void 0 : video_info.height) || 360,\n      className: \"rounded shadow w-full\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(EventTimeline, {\n      actions: (action_recognition === null || action_recognition === void 0 ? void 0 : action_recognition.actions) || [],\n      scores: scores || [],\n      gameStates: game_states || [],\n      duration: totalFrames,\n      currentFrame: currentFrame,\n      onSeek: handleSeek\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"absolute left-0 top-0 pointer-events-none\",\n      children: /*#__PURE__*/_jsxDEV(PlayerHeatmap, {\n        playerTracks: players_tracking || [],\n        videoSize: {\n          width: video_info === null || video_info === void 0 ? void 0 : video_info.width,\n          height: video_info === null || video_info === void 0 ? void 0 : video_info.height\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 73,\n    columnNumber: 5\n  }, this);\n};\n_s(VideoPlayer, \"4x04INbvYyMjHn5PiEcFxDA4II4=\", false, function () {\n  return [useParams];\n});\n_c = VideoPlayer;\nvar _c;\n$RefreshReg$(_c, \"VideoPlayer\");","map":{"version":3,"names":["React","useEffect","useRef","useState","useParams","getVideoUrl","getAnalysisResults","getVideo","EventTimeline","PlayerHeatmap","jsxDEV","_jsxDEV","VideoPlayer","videoId","_s","params","effectiveId","length","result","setResult","status","setStatus","error","setError","currentTime","setCurrentTime","videoRef","isMounted","load","meta","res","e","message","handleSeek","sec","current","el","onTime","addEventListener","removeEventListener","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","action_recognition","scores","players_tracking","game_states","video_info","fps","totalFrames","total_frames","Math","round","duration","currentFrame","max","min","ref","src","controls","width","height","actions","gameStates","onSeek","playerTracks","videoSize","_c","$RefreshReg$"],"sources":["/Users/jesse/Documents/專題/volleyball_analysis_webapp/frontend/src/components/VideoPlayer.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { useParams } from 'react-router-dom';\nimport { getVideoUrl, getAnalysisResults, getVideo } from '../services/api';\nimport { EventTimeline } from './EventTimeline';\nimport { PlayerHeatmap } from './PlayerHeatmap';\n\nexport const VideoPlayer: React.FC<{ videoId?: string }> = ({ videoId }) => {\n  const params = useParams();\n  const effectiveId = videoId && videoId.length > 0 ? videoId : (params.videoId as string);\n  const [result, setResult] = useState<any>(null);\n  const [status, setStatus] = useState<'idle'|'loading'|'processing'|'completed'|'failed'|'error'>('idle');\n  const [error, setError] = useState<string>('');\n  const [currentTime, setCurrentTime] = useState<number>(0);\n  const videoRef = useRef<HTMLVideoElement>(null);\n\n  useEffect(() => {\n    if (!effectiveId) return;\n    let isMounted = true;\n    const load = async () => {\n      setStatus('loading');\n      setError('');\n      try {\n        const meta = await getVideo(effectiveId);\n        if (!isMounted) return;\n        if (meta.status !== 'completed') {\n          setStatus(meta.status as any);\n          setResult(null);\n          return;\n        }\n        const res = await getAnalysisResults(effectiveId);\n        if (!isMounted) return;\n        setResult(res);\n        setStatus('completed');\n      } catch (e: any) {\n        setError(e?.message || 'Failed to load analysis results');\n        setStatus('error');\n      }\n    };\n    load();\n    return () => { isMounted = false; };\n  }, [effectiveId]);\n\n  const handleSeek = (sec: number) => {\n    if (videoRef.current) videoRef.current.currentTime = sec;\n  };\n\n  useEffect(() => {\n    const el = videoRef.current;\n    if (!el) return;\n    const onTime = () => setCurrentTime(el.currentTime || 0);\n    el.addEventListener('timeupdate', onTime);\n    return () => el.removeEventListener('timeupdate', onTime);\n  }, []);\n\n  if (status === 'loading') return <div className=\"max-w-3xl mx-auto bg-white rounded shadow p-6\">Loading...</div>;\n  if (status === 'processing') return <div className=\"max-w-3xl mx-auto bg-yellow-50 border border-yellow-200 text-yellow-800 rounded p-6\">Analysis in progress. Please check back later from Library.</div>;\n  if (status === 'failed') return <div className=\"max-w-3xl mx-auto bg-red-50 border border-red-200 text-red-800 rounded p-6\">Analysis failed. Please re-run analysis from Library.</div>;\n  if (status === 'error') return (\n    <div className=\"max-w-3xl mx-auto bg-red-50 border border-red-200 text-red-800 rounded p-6\">\n      <div className=\"font-semibold mb-2\">Failed to load results</div>\n      <div className=\"text-sm\">{error}</div>\n      <button onClick={() => { setStatus('idle'); setError(''); setResult(null); }} className=\"mt-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700\">Retry</button>\n    </div>\n  );\n  if (!result) return null;\n\n  const { action_recognition, scores, players_tracking, game_states, video_info } = result;\n  const fps = video_info?.fps || 30;\n  const totalFrames = video_info?.total_frames || Math.round((video_info?.duration || 0) * fps) || 1000;\n  const currentFrame = Math.max(0, Math.min(totalFrames, Math.round(currentTime * fps)));\n\n  return (\n    <div className=\"relative w-full max-w-3xl mx-auto\">\n      <video ref={videoRef} src={getVideoUrl(effectiveId)} controls width={video_info?.width || 640} height={video_info?.height || 360} className=\"rounded shadow w-full\" />\n      <EventTimeline\n        actions={action_recognition?.actions || []}\n        scores={scores || []}\n        gameStates={game_states || []}\n        duration={totalFrames}\n        currentFrame={currentFrame}\n        onSeek={handleSeek}\n      />\n      <div className=\"absolute left-0 top-0 pointer-events-none\">\n        <PlayerHeatmap playerTracks={players_tracking || []} videoSize={{ width: video_info?.width, height: video_info?.height }} />\n      </div>\n    </div>\n  );\n};\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,MAAM,EAAEC,QAAQ,QAAQ,OAAO;AAC1D,SAASC,SAAS,QAAQ,kBAAkB;AAC5C,SAASC,WAAW,EAAEC,kBAAkB,EAAEC,QAAQ,QAAQ,iBAAiB;AAC3E,SAASC,aAAa,QAAQ,iBAAiB;AAC/C,SAASC,aAAa,QAAQ,iBAAiB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEhD,OAAO,MAAMC,WAA2C,GAAGA,CAAC;EAAEC;AAAQ,CAAC,KAAK;EAAAC,EAAA;EAC1E,MAAMC,MAAM,GAAGX,SAAS,CAAC,CAAC;EAC1B,MAAMY,WAAW,GAAGH,OAAO,IAAIA,OAAO,CAACI,MAAM,GAAG,CAAC,GAAGJ,OAAO,GAAIE,MAAM,CAACF,OAAkB;EACxF,MAAM,CAACK,MAAM,EAAEC,SAAS,CAAC,GAAGhB,QAAQ,CAAM,IAAI,CAAC;EAC/C,MAAM,CAACiB,MAAM,EAAEC,SAAS,CAAC,GAAGlB,QAAQ,CAA6D,MAAM,CAAC;EACxG,MAAM,CAACmB,KAAK,EAAEC,QAAQ,CAAC,GAAGpB,QAAQ,CAAS,EAAE,CAAC;EAC9C,MAAM,CAACqB,WAAW,EAAEC,cAAc,CAAC,GAAGtB,QAAQ,CAAS,CAAC,CAAC;EACzD,MAAMuB,QAAQ,GAAGxB,MAAM,CAAmB,IAAI,CAAC;EAE/CD,SAAS,CAAC,MAAM;IACd,IAAI,CAACe,WAAW,EAAE;IAClB,IAAIW,SAAS,GAAG,IAAI;IACpB,MAAMC,IAAI,GAAG,MAAAA,CAAA,KAAY;MACvBP,SAAS,CAAC,SAAS,CAAC;MACpBE,QAAQ,CAAC,EAAE,CAAC;MACZ,IAAI;QACF,MAAMM,IAAI,GAAG,MAAMtB,QAAQ,CAACS,WAAW,CAAC;QACxC,IAAI,CAACW,SAAS,EAAE;QAChB,IAAIE,IAAI,CAACT,MAAM,KAAK,WAAW,EAAE;UAC/BC,SAAS,CAACQ,IAAI,CAACT,MAAa,CAAC;UAC7BD,SAAS,CAAC,IAAI,CAAC;UACf;QACF;QACA,MAAMW,GAAG,GAAG,MAAMxB,kBAAkB,CAACU,WAAW,CAAC;QACjD,IAAI,CAACW,SAAS,EAAE;QAChBR,SAAS,CAACW,GAAG,CAAC;QACdT,SAAS,CAAC,WAAW,CAAC;MACxB,CAAC,CAAC,OAAOU,CAAM,EAAE;QACfR,QAAQ,CAAC,CAAAQ,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEC,OAAO,KAAI,iCAAiC,CAAC;QACzDX,SAAS,CAAC,OAAO,CAAC;MACpB;IACF,CAAC;IACDO,IAAI,CAAC,CAAC;IACN,OAAO,MAAM;MAAED,SAAS,GAAG,KAAK;IAAE,CAAC;EACrC,CAAC,EAAE,CAACX,WAAW,CAAC,CAAC;EAEjB,MAAMiB,UAAU,GAAIC,GAAW,IAAK;IAClC,IAAIR,QAAQ,CAACS,OAAO,EAAET,QAAQ,CAACS,OAAO,CAACX,WAAW,GAAGU,GAAG;EAC1D,CAAC;EAEDjC,SAAS,CAAC,MAAM;IACd,MAAMmC,EAAE,GAAGV,QAAQ,CAACS,OAAO;IAC3B,IAAI,CAACC,EAAE,EAAE;IACT,MAAMC,MAAM,GAAGA,CAAA,KAAMZ,cAAc,CAACW,EAAE,CAACZ,WAAW,IAAI,CAAC,CAAC;IACxDY,EAAE,CAACE,gBAAgB,CAAC,YAAY,EAAED,MAAM,CAAC;IACzC,OAAO,MAAMD,EAAE,CAACG,mBAAmB,CAAC,YAAY,EAAEF,MAAM,CAAC;EAC3D,CAAC,EAAE,EAAE,CAAC;EAEN,IAAIjB,MAAM,KAAK,SAAS,EAAE,oBAAOT,OAAA;IAAK6B,SAAS,EAAC,+CAA+C;IAAAC,QAAA,EAAC;EAAU;IAAAC,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAK,CAAC;EAChH,IAAIzB,MAAM,KAAK,YAAY,EAAE,oBAAOT,OAAA;IAAK6B,SAAS,EAAC,qFAAqF;IAAAC,QAAA,EAAC;EAA2D;IAAAC,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAK,CAAC;EAC1M,IAAIzB,MAAM,KAAK,QAAQ,EAAE,oBAAOT,OAAA;IAAK6B,SAAS,EAAC,4EAA4E;IAAAC,QAAA,EAAC;EAAqD;IAAAC,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAK,CAAC;EACvL,IAAIzB,MAAM,KAAK,OAAO,EAAE,oBACtBT,OAAA;IAAK6B,SAAS,EAAC,4EAA4E;IAAAC,QAAA,gBACzF9B,OAAA;MAAK6B,SAAS,EAAC,oBAAoB;MAAAC,QAAA,EAAC;IAAsB;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAK,CAAC,eAChElC,OAAA;MAAK6B,SAAS,EAAC,SAAS;MAAAC,QAAA,EAAEnB;IAAK;MAAAoB,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAM,CAAC,eACtClC,OAAA;MAAQmC,OAAO,EAAEA,CAAA,KAAM;QAAEzB,SAAS,CAAC,MAAM,CAAC;QAAEE,QAAQ,CAAC,EAAE,CAAC;QAAEJ,SAAS,CAAC,IAAI,CAAC;MAAE,CAAE;MAACqB,SAAS,EAAC,iEAAiE;MAAAC,QAAA,EAAC;IAAK;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAQ,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACrK,CAAC;EAER,IAAI,CAAC3B,MAAM,EAAE,OAAO,IAAI;EAExB,MAAM;IAAE6B,kBAAkB;IAAEC,MAAM;IAAEC,gBAAgB;IAAEC,WAAW;IAAEC;EAAW,CAAC,GAAGjC,MAAM;EACxF,MAAMkC,GAAG,GAAG,CAAAD,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEC,GAAG,KAAI,EAAE;EACjC,MAAMC,WAAW,GAAG,CAAAF,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEG,YAAY,KAAIC,IAAI,CAACC,KAAK,CAAC,CAAC,CAAAL,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEM,QAAQ,KAAI,CAAC,IAAIL,GAAG,CAAC,IAAI,IAAI;EACrG,MAAMM,YAAY,GAAGH,IAAI,CAACI,GAAG,CAAC,CAAC,EAAEJ,IAAI,CAACK,GAAG,CAACP,WAAW,EAAEE,IAAI,CAACC,KAAK,CAAChC,WAAW,GAAG4B,GAAG,CAAC,CAAC,CAAC;EAEtF,oBACEzC,OAAA;IAAK6B,SAAS,EAAC,mCAAmC;IAAAC,QAAA,gBAChD9B,OAAA;MAAOkD,GAAG,EAAEnC,QAAS;MAACoC,GAAG,EAAEzD,WAAW,CAACW,WAAW,CAAE;MAAC+C,QAAQ;MAACC,KAAK,EAAE,CAAAb,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEa,KAAK,KAAI,GAAI;MAACC,MAAM,EAAE,CAAAd,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEc,MAAM,KAAI,GAAI;MAACzB,SAAS,EAAC;IAAuB;MAAAE,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC,eACtKlC,OAAA,CAACH,aAAa;MACZ0D,OAAO,EAAE,CAAAnB,kBAAkB,aAAlBA,kBAAkB,uBAAlBA,kBAAkB,CAAEmB,OAAO,KAAI,EAAG;MAC3ClB,MAAM,EAAEA,MAAM,IAAI,EAAG;MACrBmB,UAAU,EAAEjB,WAAW,IAAI,EAAG;MAC9BO,QAAQ,EAAEJ,WAAY;MACtBK,YAAY,EAAEA,YAAa;MAC3BU,MAAM,EAAEnC;IAAW;MAAAS,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACpB,CAAC,eACFlC,OAAA;MAAK6B,SAAS,EAAC,2CAA2C;MAAAC,QAAA,eACxD9B,OAAA,CAACF,aAAa;QAAC4D,YAAY,EAAEpB,gBAAgB,IAAI,EAAG;QAACqB,SAAS,EAAE;UAAEN,KAAK,EAAEb,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEa,KAAK;UAAEC,MAAM,EAAEd,UAAU,aAAVA,UAAU,uBAAVA,UAAU,CAAEc;QAAO;MAAE;QAAAvB,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE;IAAC;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACzH,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV,CAAC;AAAC/B,EAAA,CAjFWF,WAA2C;EAAA,QACvCR,SAAS;AAAA;AAAAmE,EAAA,GADb3D,WAA2C;AAAA,IAAA2D,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}